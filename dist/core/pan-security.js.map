{
  "version": 3,
  "sources": ["../../src/core/pan-security.mjs"],
  "sourcesContent": ["/**\n * @fileoverview PAN Security Utilities\n *\n * Security helpers for PAN framework:\n * - HTTPS enforcement\n * - XSS prevention\n * - Input sanitization\n * - Security best practices\n */\n\n/**\n * Check if running in production and enforce HTTPS\n * @param {Object} options - Configuration options\n * @param {boolean} [options.enforce=true] - Whether to enforce HTTPS\n * @param {string[]} [options.allowedHosts=[]] - Hosts exempt from HTTPS (e.g., localhost)\n */\nexport function enforceHTTPS(options = {}) {\n  const {\n    enforce = true,\n    allowedHosts = ['localhost', '127.0.0.1', '[::1]'],\n  } = options;\n\n  if (!enforce) return;\n\n  // Check if we're on HTTPS or an allowed host\n  const isHTTPS = location.protocol === 'https:';\n  const hostname = location.hostname;\n  const isAllowedHost = allowedHosts.some(host => hostname === host);\n\n  if (!isHTTPS && !isAllowedHost) {\n    console.error('\uD83D\uDD12 PAN Security: HTTPS is required in production');\n    console.error(`Current URL: ${location.href}`);\n    console.error('Redirecting to HTTPS...');\n\n    // Redirect to HTTPS\n    location.replace(`https:${location.href.substring(location.protocol.length)}`);\n  }\n}\n\n/**\n * Sanitize HTML to prevent XSS\n * Basic implementation - use DOMPurify for production\n *\n * @param {string} html - HTML string to sanitize\n * @returns {string} Sanitized HTML\n */\nexport function sanitizeHTML(html) {\n  if (!html || typeof html !== 'string') return '';\n\n  // Create a temporary div to parse HTML\n  const temp = document.createElement('div');\n\n  // Use textContent to escape all HTML\n  temp.textContent = html;\n\n  return temp.innerHTML;\n}\n\n/**\n * Safe innerHTML setter that sanitizes content\n *\n * @param {HTMLElement} element - Element to set content on\n * @param {string} html - HTML content (will be sanitized)\n */\nexport function safeSetHTML(element, html) {\n  if (!element) return;\n\n  // For now, use textContent as safest option\n  // In production, integrate DOMPurify\n  if (typeof html !== 'string') {\n    element.textContent = '';\n    return;\n  }\n\n  // Check if DOMPurify is available\n  if (typeof window !== 'undefined' && window.DOMPurify) {\n    element.innerHTML = window.DOMPurify.sanitize(html);\n  } else {\n    // Fallback: escape HTML\n    element.textContent = html;\n    console.warn('DOMPurify not available. Using textContent. Install DOMPurify for proper HTML sanitization.');\n  }\n}\n\n/**\n * Create a safe text node (alternative to innerHTML)\n *\n * @param {string} text - Text content\n * @returns {Text} Text node\n */\nexport function createTextNode(text) {\n  return document.createTextNode(text || '');\n}\n\n/**\n * Safely create an element with attributes\n *\n * @param {string} tag - Element tag name\n * @param {Object} attrs - Attributes to set\n * @param {string} content - Text content (not HTML)\n * @returns {HTMLElement}\n */\nexport function createElement(tag, attrs = {}, content = '') {\n  const element = document.createElement(tag);\n\n  // Set attributes safely\n  for (const [key, value] of Object.entries(attrs)) {\n    // Skip event handlers\n    if (key.startsWith('on')) {\n      console.warn(`Skipping event handler attribute: ${key}`);\n      continue;\n    }\n\n    // Skip dangerous attributes\n    if (['innerHTML', 'outerHTML'].includes(key)) {\n      console.warn(`Skipping dangerous attribute: ${key}`);\n      continue;\n    }\n\n    element.setAttribute(key, value);\n  }\n\n  // Set text content (not HTML)\n  if (content) {\n    element.textContent = content;\n  }\n\n  return element;\n}\n\n/**\n * Validate URL to prevent javascript: and data: schemes\n *\n * @param {string} url - URL to validate\n * @returns {boolean} True if URL is safe\n */\nexport function isSafeURL(url) {\n  if (!url || typeof url !== 'string') return false;\n\n  const trimmed = url.trim().toLowerCase();\n\n  // Block dangerous protocols\n  const dangerousProtocols = [\n    'javascript:',\n    'data:',\n    'vbscript:',\n    'file:',\n  ];\n\n  for (const protocol of dangerousProtocols) {\n    if (trimmed.startsWith(protocol)) {\n      console.warn(`Blocked dangerous URL protocol: ${protocol}`);\n      return false;\n    }\n  }\n\n  return true;\n}\n\n/**\n * Safely set element href (for links)\n *\n * @param {HTMLAnchorElement} element - Link element\n * @param {string} href - URL to set\n */\nexport function setSafeHref(element, href) {\n  if (!element || !href) return;\n\n  if (isSafeURL(href)) {\n    element.href = href;\n  } else {\n    console.error('Blocked unsafe URL:', href);\n    element.href = '#';\n  }\n}\n\n/**\n * Check if Content Security Policy is properly configured\n *\n * @returns {Object} CSP status\n */\nexport function checkCSP() {\n  const cspMeta = document.querySelector('meta[http-equiv=\"Content-Security-Policy\"]');\n  const cspHeader = document.querySelector('meta[name=\"Content-Security-Policy\"]');\n\n  const hasCSP = !!(cspMeta || cspHeader);\n\n  if (!hasCSP) {\n    console.warn('\u26A0 PAN Security: No Content-Security-Policy found');\n    console.warn('Add CSP meta tag or header for better security');\n  }\n\n  return {\n    configured: hasCSP,\n    meta: cspMeta ? cspMeta.content : null,\n    header: cspHeader ? cspHeader.content : null,\n  };\n}\n\n/**\n * Initialize PAN security features\n *\n * @param {Object} options - Configuration options\n */\nexport function initSecurity(options = {}) {\n  const {\n    enforceHTTPS: shouldEnforceHTTPS = true,\n    checkCSP: shouldCheckCSP = true,\n  } = options;\n\n  console.log('\uD83D\uDEE1\uFE0F PAN Security initializing...');\n\n  // Enforce HTTPS\n  if (shouldEnforceHTTPS) {\n    enforceHTTPS();\n  }\n\n  // Check CSP\n  if (shouldCheckCSP) {\n    checkCSP();\n  }\n\n  console.log('\u2713 PAN Security initialized');\n}\n\n/**\n * Escape HTML special characters\n *\n * @param {string} text - Text to escape\n * @returns {string} Escaped text\n */\nexport function escapeHTML(text) {\n  if (!text || typeof text !== 'string') return '';\n\n  const map = {\n    '&': '&amp;',\n    '<': '&lt;',\n    '>': '&gt;',\n    '\"': '&quot;',\n    \"'\": '&#039;',\n  };\n\n  return text.replace(/[&<>\"']/g, m => map[m]);\n}\n\n/**\n * Strip all HTML tags from a string\n *\n * @param {string} html - HTML string\n * @returns {string} Plain text\n */\nexport function stripHTML(html) {\n  if (!html || typeof html !== 'string') return '';\n\n  const temp = document.createElement('div');\n  temp.innerHTML = html;\n  return temp.textContent || temp.innerText || '';\n}\n\nexport default {\n  enforceHTTPS,\n  sanitizeHTML,\n  safeSetHTML,\n  createTextNode,\n  createElement,\n  isSafeURL,\n  setSafeHref,\n  checkCSP,\n  initSecurity,\n  escapeHTML,\n  stripHTML,\n};\n"],
  "mappings": "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",
  "names": []
}
