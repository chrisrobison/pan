{
  "version": 3,
  "sources": ["../../src/core/pan-bus.mjs"],
  "sourcesContent": ["/**\n * @fileoverview PAN Bus (Enhanced) - Central message bus with memory management and security\n *\n * Enhanced features:\n * - Memory-bounded retained message store with LRU eviction\n * - Automatic cleanup of dead subscriptions\n * - Message validation (size limits, JSON-serializable)\n * - Rate limiting per publisher\n * - Security policies for wildcard subscriptions\n * - Debug mode with comprehensive logging\n *\n * @example\n * // Basic usage (same API as original)\n * <pan-bus></pan-bus>\n *\n * // With configuration\n * <pan-bus\n *   max-retained=\"1000\"\n *   max-message-size=\"1048576\"\n *   debug=\"true\"\n *   allow-global-wildcard=\"false\">\n * </pan-bus>\n */\n\n/**\n * Default configuration values\n */\nconst DEFAULTS = {\n  maxRetained: 1000,           // Maximum retained messages\n  maxMessageSize: 1048576,     // 1MB max message size\n  maxPayloadSize: 524288,      // 512KB max data payload\n  cleanupInterval: 30000,      // 30s cleanup interval\n  rateLimit: 1000,             // Max messages per client per second\n  rateLimitWindow: 1000,       // Rate limit window (ms)\n  allowGlobalWildcard: true,   // Allow '*' subscriptions\n  debug: false                 // Debug logging\n};\n\n/**\n * Validates if data is JSON-serializable\n */\nfunction isSerializable(data) {\n  try {\n    JSON.stringify(data);\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\n/**\n * Get approximate size of object in bytes\n */\nfunction estimateSize(obj) {\n  try {\n    return new Blob([JSON.stringify(obj)]).size;\n  } catch (e) {\n    return 0;\n  }\n}\n\n/**\n * Checks if element is still in DOM\n */\nfunction isElementAlive(el) {\n  if (!el || !el.isConnected) return false;\n  return document.contains(el) || document.body.contains(el);\n}\n\n/**\n * PAN Bus (Enhanced) - Memory-safe, secure message bus\n *\n * @class\n * @extends HTMLElement\n */\nclass PanBusEnhanced extends HTMLElement {\n  /**\n   * Observed attributes for configuration\n   */\n  static get observedAttributes() {\n    return [\n      'max-retained',\n      'max-message-size',\n      'max-payload-size',\n      'cleanup-interval',\n      'rate-limit',\n      'allow-global-wildcard',\n      'debug'\n    ];\n  }\n\n  constructor() {\n    super();\n\n    // Configuration (can be overridden via attributes)\n    this.config = { ...DEFAULTS };\n\n    // Core data structures\n    this.subs = [];\n    this.clients = new Map();\n\n    // Retained messages with LRU tracking\n    this.retained = new Map();\n    this.retainedAccessOrder = []; // For LRU eviction\n\n    // Rate limiting tracking\n    this.publishCounts = new Map(); // clientId -> { count, windowStart }\n\n    // Statistics for monitoring\n    this.stats = {\n      published: 0,\n      delivered: 0,\n      dropped: 0,\n      retainedEvicted: 0,\n      subsCleanedUp: 0,\n      errors: 0\n    };\n\n    // Cleanup timer\n    this.cleanupTimer = null;\n  }\n\n  /**\n   * Attribute change handler\n   */\n  attributeChangedCallback(name, oldValue, newValue) {\n    if (oldValue === newValue) return;\n\n    switch (name) {\n      case 'max-retained':\n        this.config.maxRetained = parseInt(newValue, 10) || DEFAULTS.maxRetained;\n        break;\n      case 'max-message-size':\n        this.config.maxMessageSize = parseInt(newValue, 10) || DEFAULTS.maxMessageSize;\n        break;\n      case 'max-payload-size':\n        this.config.maxPayloadSize = parseInt(newValue, 10) || DEFAULTS.maxPayloadSize;\n        break;\n      case 'cleanup-interval':\n        this.config.cleanupInterval = parseInt(newValue, 10) || DEFAULTS.cleanupInterval;\n        if (this.cleanupTimer) {\n          this._setupCleanup();\n        }\n        break;\n      case 'rate-limit':\n        this.config.rateLimit = parseInt(newValue, 10) || DEFAULTS.rateLimit;\n        break;\n      case 'allow-global-wildcard':\n        this.config.allowGlobalWildcard = newValue === 'true';\n        break;\n      case 'debug':\n        this.config.debug = newValue === 'true';\n        break;\n    }\n  }\n\n  connectedCallback() {\n    // Set up event listeners\n    document.addEventListener('pan:publish', this.onPublish, true);\n    document.addEventListener('pan:request', this.onPublish, true);\n    document.addEventListener('pan:reply', this.onReply, true);\n    document.addEventListener('pan:subscribe', this.onSubscribe, true);\n    document.addEventListener('pan:unsubscribe', this.onUnsubscribe, true);\n    document.addEventListener('pan:hello', this.onHello, true);\n\n    // Control topics\n    document.addEventListener('pan:sys.stats', this.onGetStats, true);\n    document.addEventListener('pan:sys.clear-retained', this.onClearRetained, true);\n\n    // Set up periodic cleanup\n    this._setupCleanup();\n\n    // Announce readiness\n    window.__panReady = true;\n    this._log('PAN Bus Enhanced ready', this.config);\n    document.dispatchEvent(\n      new CustomEvent('pan:sys.ready', {\n        bubbles: true,\n        composed: true,\n        detail: { enhanced: true, config: this.config }\n      })\n    );\n  }\n\n  disconnectedCallback() {\n    // Clean up listeners\n    document.removeEventListener('pan:publish', this.onPublish, true);\n    document.removeEventListener('pan:request', this.onPublish, true);\n    document.removeEventListener('pan:reply', this.onReply, true);\n    document.removeEventListener('pan:subscribe', this.onSubscribe, true);\n    document.removeEventListener('pan:unsubscribe', this.onUnsubscribe, true);\n    document.removeEventListener('pan:hello', this.onHello, true);\n    document.removeEventListener('pan:sys.stats', this.onGetStats, true);\n    document.removeEventListener('pan:sys.clear-retained', this.onClearRetained, true);\n\n    // Stop cleanup timer\n    if (this.cleanupTimer) {\n      clearInterval(this.cleanupTimer);\n      this.cleanupTimer = null;\n    }\n  }\n\n  /**\n   * Set up periodic cleanup of dead subscriptions\n   * @private\n   */\n  _setupCleanup() {\n    if (this.cleanupTimer) {\n      clearInterval(this.cleanupTimer);\n    }\n\n    this.cleanupTimer = setInterval(() => {\n      this._cleanupDeadSubscriptions();\n      this._cleanupRateLimits();\n    }, this.config.cleanupInterval);\n  }\n\n  /**\n   * Remove subscriptions for elements that have been removed from DOM\n   * @private\n   */\n  _cleanupDeadSubscriptions() {\n    const before = this.subs.length;\n    this.subs = this.subs.filter(s => isElementAlive(s.el));\n    const removed = before - this.subs.length;\n\n    if (removed > 0) {\n      this.stats.subsCleanedUp += removed;\n      this._log(`Cleaned up ${removed} dead subscriptions`);\n    }\n  }\n\n  /**\n   * Clean up old rate limit tracking data\n   * @private\n   */\n  _cleanupRateLimits() {\n    const now = Date.now();\n    for (const [clientId, data] of this.publishCounts.entries()) {\n      if (now - data.windowStart > this.config.rateLimitWindow * 2) {\n        this.publishCounts.delete(clientId);\n      }\n    }\n  }\n\n  /**\n   * Check rate limit for a client\n   * @private\n   */\n  _checkRateLimit(clientId) {\n    const now = Date.now();\n    let data = this.publishCounts.get(clientId);\n\n    if (!data || now - data.windowStart > this.config.rateLimitWindow) {\n      // New window\n      data = { count: 1, windowStart: now };\n      this.publishCounts.set(clientId, data);\n      return true;\n    }\n\n    if (data.count >= this.config.rateLimit) {\n      this._error('Rate limit exceeded', { clientId, limit: this.config.rateLimit });\n      return false;\n    }\n\n    data.count++;\n    return true;\n  }\n\n  /**\n   * Validate message before processing\n   * @private\n   */\n  _validateMessage(msg) {\n    // Check topic\n    if (!msg.topic || typeof msg.topic !== 'string') {\n      return { valid: false, error: 'Invalid topic: must be a non-empty string' };\n    }\n\n    // Check data is serializable\n    if (msg.data !== undefined && !isSerializable(msg.data)) {\n      return { valid: false, error: 'Data must be JSON-serializable (no functions, DOM nodes, circular refs)' };\n    }\n\n    // Check message size\n    const msgSize = estimateSize(msg);\n    if (msgSize > this.config.maxMessageSize) {\n      return {\n        valid: false,\n        error: `Message size (${msgSize} bytes) exceeds limit (${this.config.maxMessageSize} bytes)`\n      };\n    }\n\n    // Check payload size separately\n    const dataSize = estimateSize(msg.data);\n    if (dataSize > this.config.maxPayloadSize) {\n      return {\n        valid: false,\n        error: `Payload size (${dataSize} bytes) exceeds limit (${this.config.maxPayloadSize} bytes)`\n      };\n    }\n\n    return { valid: true };\n  }\n\n  /**\n   * Store retained message with LRU eviction\n   * @private\n   */\n  _storeRetained(topic, msg) {\n    // Remove from access order if already present\n    const idx = this.retainedAccessOrder.indexOf(topic);\n    if (idx !== -1) {\n      this.retainedAccessOrder.splice(idx, 1);\n    }\n\n    // Add to end (most recent)\n    this.retainedAccessOrder.push(topic);\n    this.retained.set(topic, msg);\n\n    // Evict oldest if over limit\n    while (this.retained.size > this.config.maxRetained) {\n      const oldest = this.retainedAccessOrder.shift();\n      if (oldest) {\n        this.retained.delete(oldest);\n        this.stats.retainedEvicted++;\n        this._log(`Evicted retained message for topic: ${oldest}`);\n      }\n    }\n  }\n\n  /**\n   * Get retained message and update LRU\n   * @private\n   */\n  _getRetained(topic) {\n    const msg = this.retained.get(topic);\n    if (msg) {\n      // Move to end (most recently accessed)\n      const idx = this.retainedAccessOrder.indexOf(topic);\n      if (idx !== -1) {\n        this.retainedAccessOrder.splice(idx, 1);\n        this.retainedAccessOrder.push(topic);\n      }\n    }\n    return msg;\n  }\n\n  /**\n   * Validate subscription pattern for security\n   * @private\n   */\n  _validateSubscription(pattern) {\n    // Check global wildcard\n    if (pattern === '*' && !this.config.allowGlobalWildcard) {\n      return {\n        valid: false,\n        error: 'Global wildcard (*) subscriptions are disabled for security'\n      };\n    }\n\n    // Topic pattern validation\n    if (!pattern || typeof pattern !== 'string') {\n      return { valid: false, error: 'Pattern must be a non-empty string' };\n    }\n\n    // Could add more validation (e.g., max wildcard count, pattern complexity)\n\n    return { valid: true };\n  }\n\n  onHello = (e) => {\n    const d = e.detail || {};\n    if (d.id) {\n      this.clients.set(d.id, { el: this._et(e), caps: d.caps || [] });\n      this._log('Client registered', { id: d.id, caps: d.caps });\n    }\n  };\n\n  onSubscribe = (e) => {\n    const { topics = [], options = {}, clientId } = e.detail || {};\n    const el = this._et(e);\n\n    // Validate each pattern\n    for (const pattern of topics) {\n      const validation = this._validateSubscription(pattern);\n      if (!validation.valid) {\n        this._error('Subscription rejected', { pattern, reason: validation.error });\n        this._emitError(el, 'SUBSCRIPTION_INVALID', validation.error, { pattern });\n        continue;\n      }\n\n      this.subs.push({ pattern, el, clientId, retained: !!options.retained });\n      this._log('Subscription added', { pattern, clientId });\n    }\n\n    // Deliver retained snapshots if requested\n    if (options.retained) {\n      for (const [topic, msg] of this.retained) {\n        if (topics.some((p) => PanBusEnhanced.matches(topic, p))) {\n          this._deliver(el, this._getRetained(topic));\n        }\n      }\n    }\n  };\n\n  onUnsubscribe = (e) => {\n    const { topics = [], clientId } = e.detail || {};\n    const el = this._et(e);\n    const before = this.subs.length;\n\n    this.subs = this.subs.filter((s) => {\n      const sameClient = clientId ? s.clientId === clientId : s.el === el;\n      return !(sameClient && topics.includes(s.pattern));\n    });\n\n    const removed = before - this.subs.length;\n    if (removed > 0) {\n      this._log('Unsubscribed', { topics, clientId, count: removed });\n    }\n  };\n\n  onPublish = (e) => {\n    const base = e.detail || {};\n    const el = this._et(e);\n\n    // Get client ID (try to extract from element or use a default)\n    const clientId = base.clientId ||\n                    (el && el.dataset && el.dataset.panClientId) ||\n                    'anonymous';\n\n    // Rate limiting\n    if (!this._checkRateLimit(clientId)) {\n      this.stats.dropped++;\n      this._emitError(el, 'RATE_LIMIT_EXCEEDED', 'Too many messages', { clientId });\n      return;\n    }\n\n    // Enhance message\n    const msg = {\n      ts: Date.now(),\n      id: crypto.randomUUID(),\n      ...base\n    };\n\n    // Validate message\n    const validation = this._validateMessage(msg);\n    if (!validation.valid) {\n      this.stats.errors++;\n      this._error('Message validation failed', { topic: msg.topic, error: validation.error });\n      this._emitError(el, 'MESSAGE_INVALID', validation.error, { topic: msg.topic });\n      return;\n    }\n\n    this.stats.published++;\n\n    // Store retained message with LRU\n    if (msg.retain) {\n      this._storeRetained(msg.topic, msg);\n    }\n\n    // Deliver to matching subscribers\n    let delivered = 0;\n    for (const s of this.subs) {\n      if (PanBusEnhanced.matches(msg.topic, s.pattern)) {\n        if (this._deliver(s.el, msg)) {\n          delivered++;\n        }\n      }\n    }\n\n    this.stats.delivered += delivered;\n    this._log('Published', { topic: msg.topic, retain: msg.retain, delivered });\n  };\n\n  onReply = (e) => {\n    const msg = e.detail || {};\n\n    // Deliver to matching subscribers\n    for (const s of this.subs) {\n      if (PanBusEnhanced.matches(msg.topic, s.pattern)) {\n        this._deliver(s.el, msg);\n      }\n    }\n  };\n\n  /**\n   * Handle stats request\n   * @private\n   */\n  onGetStats = (e) => {\n    const el = this._et(e);\n    const stats = {\n      ...this.stats,\n      subscriptions: this.subs.length,\n      clients: this.clients.size,\n      retained: this.retained.size,\n      config: this.config\n    };\n\n    // Reply with stats\n    el.dispatchEvent(\n      new CustomEvent('pan:deliver', {\n        detail: {\n          topic: 'pan:sys.stats',\n          data: stats,\n          id: crypto.randomUUID(),\n          ts: Date.now()\n        }\n      })\n    );\n  };\n\n  /**\n   * Handle clear retained messages request\n   * @private\n   */\n  onClearRetained = (e) => {\n    const { pattern } = e.detail || {};\n\n    if (pattern) {\n      // Clear matching topics\n      let cleared = 0;\n      for (const topic of this.retained.keys()) {\n        if (PanBusEnhanced.matches(topic, pattern)) {\n          this.retained.delete(topic);\n          const idx = this.retainedAccessOrder.indexOf(topic);\n          if (idx !== -1) {\n            this.retainedAccessOrder.splice(idx, 1);\n          }\n          cleared++;\n        }\n      }\n      this._log(`Cleared ${cleared} retained messages matching pattern: ${pattern}`);\n    } else {\n      // Clear all\n      const count = this.retained.size;\n      this.retained.clear();\n      this.retainedAccessOrder = [];\n      this._log(`Cleared all ${count} retained messages`);\n    }\n  };\n\n  /**\n   * Deliver message to target element\n   * Returns true if successful, false otherwise\n   * @private\n   */\n  _deliver(target, msg) {\n    try {\n      if (!isElementAlive(target)) {\n        return false;\n      }\n\n      target.dispatchEvent(new CustomEvent('pan:deliver', { detail: msg }));\n      return true;\n    } catch (err) {\n      this._error('Delivery failed', { topic: msg.topic, error: err.message });\n      return false;\n    }\n  }\n\n  /**\n   * Emit error event\n   * @private\n   */\n  _emitError(target, code, message, details = {}) {\n    const errorMsg = {\n      topic: 'pan:sys.error',\n      data: { code, message, details },\n      id: crypto.randomUUID(),\n      ts: Date.now()\n    };\n\n    try {\n      target.dispatchEvent(new CustomEvent('pan:deliver', { detail: errorMsg }));\n    } catch (e) {\n      // Can't deliver error, log it\n      this._error('Cannot deliver error event', { code, message });\n    }\n\n    // Also dispatch globally for monitoring\n    document.dispatchEvent(\n      new CustomEvent('pan:sys.error', {\n        bubbles: true,\n        composed: true,\n        detail: errorMsg.data\n      })\n    );\n  }\n\n  /**\n   * Get event target\n   * @private\n   */\n  _et(e) {\n    return (typeof e.composedPath === 'function'\n      ? e.composedPath()[0]\n      : (e.target || document));\n  }\n\n  /**\n   * Debug logging\n   * @private\n   */\n  _log(...args) {\n    if (this.config.debug) {\n      console.log('[PAN Bus]', ...args);\n    }\n  }\n\n  /**\n   * Error logging (always enabled)\n   * @private\n   */\n  _error(...args) {\n    console.error('[PAN Bus ERROR]', ...args);\n    this.stats.errors++;\n  }\n\n  /**\n   * Topic matching (same as original)\n   * @static\n   */\n  static matches(topic, pattern) {\n    if (pattern === '*' || topic === pattern) return true;\n\n    if (pattern && pattern.includes('*')) {\n      const esc = (s) => s.replace(/[|\\\\{}()\\[\\]^$+?.]/g, '\\\\$&').replace(/\\*/g, '[^.]+');\n      const rx = new RegExp(`^${esc(pattern)}$`);\n      return rx.test(topic);\n    }\n\n    return false;\n  }\n}\n\n// Export for use\ncustomElements.define('pan-bus-enhanced', PanBusEnhanced);\nexport { PanBusEnhanced };\nexport default PanBusEnhanced;\n"],
  "mappings": "AA2BA,MAAM,WAAW;AAAA,EACf,aAAa;AAAA;AAAA,EACb,gBAAgB;AAAA;AAAA,EAChB,gBAAgB;AAAA;AAAA,EAChB,iBAAiB;AAAA;AAAA,EACjB,WAAW;AAAA;AAAA,EACX,iBAAiB;AAAA;AAAA,EACjB,qBAAqB;AAAA;AAAA,EACrB,OAAO;AAAA;AACT;AAKA,SAAS,eAAe,MAAM;AAC5B,MAAI;AACF,SAAK,UAAU,IAAI;AACnB,WAAO;AAAA,EACT,SAAS,GAAG;AACV,WAAO;AAAA,EACT;AACF;AAKA,SAAS,aAAa,KAAK;AACzB,MAAI;AACF,WAAO,IAAI,KAAK,CAAC,KAAK,UAAU,GAAG,CAAC,CAAC,EAAE;AAAA,EACzC,SAAS,GAAG;AACV,WAAO;AAAA,EACT;AACF;AAKA,SAAS,eAAe,IAAI;AAC1B,MAAI,CAAC,MAAM,CAAC,GAAG,YAAa,QAAO;AACnC,SAAO,SAAS,SAAS,EAAE,KAAK,SAAS,KAAK,SAAS,EAAE;AAC3D;AAQA,MAAM,uBAAuB,YAAY;AAAA;AAAA;AAAA;AAAA,EAIvC,WAAW,qBAAqB;AAC9B,WAAO;AAAA,MACL;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACF;AAAA,EACF;AAAA,EAEA,cAAc;AACZ,UAAM;AAGN,SAAK,SAAS,EAAE,GAAG,SAAS;AAG5B,SAAK,OAAO,CAAC;AACb,SAAK,UAAU,oBAAI,IAAI;AAGvB,SAAK,WAAW,oBAAI,IAAI;AACxB,SAAK,sBAAsB,CAAC;AAG5B,SAAK,gBAAgB,oBAAI,IAAI;AAG7B,SAAK,QAAQ;AAAA,MACX,WAAW;AAAA,MACX,WAAW;AAAA,MACX,SAAS;AAAA,MACT,iBAAiB;AAAA,MACjB,eAAe;AAAA,MACf,QAAQ;AAAA,IACV;AAGA,SAAK,eAAe;AAAA,EACtB;AAAA;AAAA;AAAA;AAAA,EAKA,yBAAyB,MAAM,UAAU,UAAU;AACjD,QAAI,aAAa,SAAU;AAE3B,YAAQ,MAAM;AAAA,MACZ,KAAK;AACH,aAAK,OAAO,cAAc,SAAS,UAAU,EAAE,KAAK,SAAS;AAC7D;AAAA,MACF,KAAK;AACH,aAAK,OAAO,iBAAiB,SAAS,UAAU,EAAE,KAAK,SAAS;AAChE;AAAA,MACF,KAAK;AACH,aAAK,OAAO,iBAAiB,SAAS,UAAU,EAAE,KAAK,SAAS;AAChE;AAAA,MACF,KAAK;AACH,aAAK,OAAO,kBAAkB,SAAS,UAAU,EAAE,KAAK,SAAS;AACjE,YAAI,KAAK,cAAc;AACrB,eAAK,cAAc;AAAA,QACrB;AACA;AAAA,MACF,KAAK;AACH,aAAK,OAAO,YAAY,SAAS,UAAU,EAAE,KAAK,SAAS;AAC3D;AAAA,MACF,KAAK;AACH,aAAK,OAAO,sBAAsB,aAAa;AAC/C;AAAA,MACF,KAAK;AACH,aAAK,OAAO,QAAQ,aAAa;AACjC;AAAA,IACJ;AAAA,EACF;AAAA,EAEA,oBAAoB;AAElB,aAAS,iBAAiB,eAAe,KAAK,WAAW,IAAI;AAC7D,aAAS,iBAAiB,eAAe,KAAK,WAAW,IAAI;AAC7D,aAAS,iBAAiB,aAAa,KAAK,SAAS,IAAI;AACzD,aAAS,iBAAiB,iBAAiB,KAAK,aAAa,IAAI;AACjE,aAAS,iBAAiB,mBAAmB,KAAK,eAAe,IAAI;AACrE,aAAS,iBAAiB,aAAa,KAAK,SAAS,IAAI;AAGzD,aAAS,iBAAiB,iBAAiB,KAAK,YAAY,IAAI;AAChE,aAAS,iBAAiB,0BAA0B,KAAK,iBAAiB,IAAI;AAG9E,SAAK,cAAc;AAGnB,WAAO,aAAa;AACpB,SAAK,KAAK,0BAA0B,KAAK,MAAM;AAC/C,aAAS;AAAA,MACP,IAAI,YAAY,iBAAiB;AAAA,QAC/B,SAAS;AAAA,QACT,UAAU;AAAA,QACV,QAAQ,EAAE,UAAU,MAAM,QAAQ,KAAK,OAAO;AAAA,MAChD,CAAC;AAAA,IACH;AAAA,EACF;AAAA,EAEA,uBAAuB;AAErB,aAAS,oBAAoB,eAAe,KAAK,WAAW,IAAI;AAChE,aAAS,oBAAoB,eAAe,KAAK,WAAW,IAAI;AAChE,aAAS,oBAAoB,aAAa,KAAK,SAAS,IAAI;AAC5D,aAAS,oBAAoB,iBAAiB,KAAK,aAAa,IAAI;AACpE,aAAS,oBAAoB,mBAAmB,KAAK,eAAe,IAAI;AACxE,aAAS,oBAAoB,aAAa,KAAK,SAAS,IAAI;AAC5D,aAAS,oBAAoB,iBAAiB,KAAK,YAAY,IAAI;AACnE,aAAS,oBAAoB,0BAA0B,KAAK,iBAAiB,IAAI;AAGjF,QAAI,KAAK,cAAc;AACrB,oBAAc,KAAK,YAAY;AAC/B,WAAK,eAAe;AAAA,IACtB;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,gBAAgB;AACd,QAAI,KAAK,cAAc;AACrB,oBAAc,KAAK,YAAY;AAAA,IACjC;AAEA,SAAK,eAAe,YAAY,MAAM;AACpC,WAAK,0BAA0B;AAC/B,WAAK,mBAAmB;AAAA,IAC1B,GAAG,KAAK,OAAO,eAAe;AAAA,EAChC;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,4BAA4B;AAC1B,UAAM,SAAS,KAAK,KAAK;AACzB,SAAK,OAAO,KAAK,KAAK,OAAO,OAAK,eAAe,EAAE,EAAE,CAAC;AACtD,UAAM,UAAU,SAAS,KAAK,KAAK;AAEnC,QAAI,UAAU,GAAG;AACf,WAAK,MAAM,iBAAiB;AAC5B,WAAK,KAAK,cAAc,OAAO,qBAAqB;AAAA,IACtD;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,qBAAqB;AACnB,UAAM,MAAM,KAAK,IAAI;AACrB,eAAW,CAAC,UAAU,IAAI,KAAK,KAAK,cAAc,QAAQ,GAAG;AAC3D,UAAI,MAAM,KAAK,cAAc,KAAK,OAAO,kBAAkB,GAAG;AAC5D,aAAK,cAAc,OAAO,QAAQ;AAAA,MACpC;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,gBAAgB,UAAU;AACxB,UAAM,MAAM,KAAK,IAAI;AACrB,QAAI,OAAO,KAAK,cAAc,IAAI,QAAQ;AAE1C,QAAI,CAAC,QAAQ,MAAM,KAAK,cAAc,KAAK,OAAO,iBAAiB;AAEjE,aAAO,EAAE,OAAO,GAAG,aAAa,IAAI;AACpC,WAAK,cAAc,IAAI,UAAU,IAAI;AACrC,aAAO;AAAA,IACT;AAEA,QAAI,KAAK,SAAS,KAAK,OAAO,WAAW;AACvC,WAAK,OAAO,uBAAuB,EAAE,UAAU,OAAO,KAAK,OAAO,UAAU,CAAC;AAC7E,aAAO;AAAA,IACT;AAEA,SAAK;AACL,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,iBAAiB,KAAK;AAEpB,QAAI,CAAC,IAAI,SAAS,OAAO,IAAI,UAAU,UAAU;AAC/C,aAAO,EAAE,OAAO,OAAO,OAAO,4CAA4C;AAAA,IAC5E;AAGA,QAAI,IAAI,SAAS,UAAa,CAAC,eAAe,IAAI,IAAI,GAAG;AACvD,aAAO,EAAE,OAAO,OAAO,OAAO,0EAA0E;AAAA,IAC1G;AAGA,UAAM,UAAU,aAAa,GAAG;AAChC,QAAI,UAAU,KAAK,OAAO,gBAAgB;AACxC,aAAO;AAAA,QACL,OAAO;AAAA,QACP,OAAO,iBAAiB,OAAO,0BAA0B,KAAK,OAAO,cAAc;AAAA,MACrF;AAAA,IACF;AAGA,UAAM,WAAW,aAAa,IAAI,IAAI;AACtC,QAAI,WAAW,KAAK,OAAO,gBAAgB;AACzC,aAAO;AAAA,QACL,OAAO;AAAA,QACP,OAAO,iBAAiB,QAAQ,0BAA0B,KAAK,OAAO,cAAc;AAAA,MACtF;AAAA,IACF;AAEA,WAAO,EAAE,OAAO,KAAK;AAAA,EACvB;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,eAAe,OAAO,KAAK;AAEzB,UAAM,MAAM,KAAK,oBAAoB,QAAQ,KAAK;AAClD,QAAI,QAAQ,IAAI;AACd,WAAK,oBAAoB,OAAO,KAAK,CAAC;AAAA,IACxC;AAGA,SAAK,oBAAoB,KAAK,KAAK;AACnC,SAAK,SAAS,IAAI,OAAO,GAAG;AAG5B,WAAO,KAAK,SAAS,OAAO,KAAK,OAAO,aAAa;AACnD,YAAM,SAAS,KAAK,oBAAoB,MAAM;AAC9C,UAAI,QAAQ;AACV,aAAK,SAAS,OAAO,MAAM;AAC3B,aAAK,MAAM;AACX,aAAK,KAAK,uCAAuC,MAAM,EAAE;AAAA,MAC3D;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,aAAa,OAAO;AAClB,UAAM,MAAM,KAAK,SAAS,IAAI,KAAK;AACnC,QAAI,KAAK;AAEP,YAAM,MAAM,KAAK,oBAAoB,QAAQ,KAAK;AAClD,UAAI,QAAQ,IAAI;AACd,aAAK,oBAAoB,OAAO,KAAK,CAAC;AACtC,aAAK,oBAAoB,KAAK,KAAK;AAAA,MACrC;AAAA,IACF;AACA,WAAO;AAAA,EACT;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,sBAAsB,SAAS;AAE7B,QAAI,YAAY,OAAO,CAAC,KAAK,OAAO,qBAAqB;AACvD,aAAO;AAAA,QACL,OAAO;AAAA,QACP,OAAO;AAAA,MACT;AAAA,IACF;AAGA,QAAI,CAAC,WAAW,OAAO,YAAY,UAAU;AAC3C,aAAO,EAAE,OAAO,OAAO,OAAO,qCAAqC;AAAA,IACrE;AAIA,WAAO,EAAE,OAAO,KAAK;AAAA,EACvB;AAAA,EAEA,UAAU,CAAC,MAAM;AACf,UAAM,IAAI,EAAE,UAAU,CAAC;AACvB,QAAI,EAAE,IAAI;AACR,WAAK,QAAQ,IAAI,EAAE,IAAI,EAAE,IAAI,KAAK,IAAI,CAAC,GAAG,MAAM,EAAE,QAAQ,CAAC,EAAE,CAAC;AAC9D,WAAK,KAAK,qBAAqB,EAAE,IAAI,EAAE,IAAI,MAAM,EAAE,KAAK,CAAC;AAAA,IAC3D;AAAA,EACF;AAAA,EAEA,cAAc,CAAC,MAAM;AACnB,UAAM,EAAE,SAAS,CAAC,GAAG,UAAU,CAAC,GAAG,SAAS,IAAI,EAAE,UAAU,CAAC;AAC7D,UAAM,KAAK,KAAK,IAAI,CAAC;AAGrB,eAAW,WAAW,QAAQ;AAC5B,YAAM,aAAa,KAAK,sBAAsB,OAAO;AACrD,UAAI,CAAC,WAAW,OAAO;AACrB,aAAK,OAAO,yBAAyB,EAAE,SAAS,QAAQ,WAAW,MAAM,CAAC;AAC1E,aAAK,WAAW,IAAI,wBAAwB,WAAW,OAAO,EAAE,QAAQ,CAAC;AACzE;AAAA,MACF;AAEA,WAAK,KAAK,KAAK,EAAE,SAAS,IAAI,UAAU,UAAU,CAAC,CAAC,QAAQ,SAAS,CAAC;AACtE,WAAK,KAAK,sBAAsB,EAAE,SAAS,SAAS,CAAC;AAAA,IACvD;AAGA,QAAI,QAAQ,UAAU;AACpB,iBAAW,CAAC,OAAO,GAAG,KAAK,KAAK,UAAU;AACxC,YAAI,OAAO,KAAK,CAAC,MAAM,eAAe,QAAQ,OAAO,CAAC,CAAC,GAAG;AACxD,eAAK,SAAS,IAAI,KAAK,aAAa,KAAK,CAAC;AAAA,QAC5C;AAAA,MACF;AAAA,IACF;AAAA,EACF;AAAA,EAEA,gBAAgB,CAAC,MAAM;AACrB,UAAM,EAAE,SAAS,CAAC,GAAG,SAAS,IAAI,EAAE,UAAU,CAAC;AAC/C,UAAM,KAAK,KAAK,IAAI,CAAC;AACrB,UAAM,SAAS,KAAK,KAAK;AAEzB,SAAK,OAAO,KAAK,KAAK,OAAO,CAAC,MAAM;AAClC,YAAM,aAAa,WAAW,EAAE,aAAa,WAAW,EAAE,OAAO;AACjE,aAAO,EAAE,cAAc,OAAO,SAAS,EAAE,OAAO;AAAA,IAClD,CAAC;AAED,UAAM,UAAU,SAAS,KAAK,KAAK;AACnC,QAAI,UAAU,GAAG;AACf,WAAK,KAAK,gBAAgB,EAAE,QAAQ,UAAU,OAAO,QAAQ,CAAC;AAAA,IAChE;AAAA,EACF;AAAA,EAEA,YAAY,CAAC,MAAM;AACjB,UAAM,OAAO,EAAE,UAAU,CAAC;AAC1B,UAAM,KAAK,KAAK,IAAI,CAAC;AAGrB,UAAM,WAAW,KAAK,YACL,MAAM,GAAG,WAAW,GAAG,QAAQ,eAChC;AAGhB,QAAI,CAAC,KAAK,gBAAgB,QAAQ,GAAG;AACnC,WAAK,MAAM;AACX,WAAK,WAAW,IAAI,uBAAuB,qBAAqB,EAAE,SAAS,CAAC;AAC5E;AAAA,IACF;AAGA,UAAM,MAAM;AAAA,MACV,IAAI,KAAK,IAAI;AAAA,MACb,IAAI,OAAO,WAAW;AAAA,MACtB,GAAG;AAAA,IACL;AAGA,UAAM,aAAa,KAAK,iBAAiB,GAAG;AAC5C,QAAI,CAAC,WAAW,OAAO;AACrB,WAAK,MAAM;AACX,WAAK,OAAO,6BAA6B,EAAE,OAAO,IAAI,OAAO,OAAO,WAAW,MAAM,CAAC;AACtF,WAAK,WAAW,IAAI,mBAAmB,WAAW,OAAO,EAAE,OAAO,IAAI,MAAM,CAAC;AAC7E;AAAA,IACF;AAEA,SAAK,MAAM;AAGX,QAAI,IAAI,QAAQ;AACd,WAAK,eAAe,IAAI,OAAO,GAAG;AAAA,IACpC;AAGA,QAAI,YAAY;AAChB,eAAW,KAAK,KAAK,MAAM;AACzB,UAAI,eAAe,QAAQ,IAAI,OAAO,EAAE,OAAO,GAAG;AAChD,YAAI,KAAK,SAAS,EAAE,IAAI,GAAG,GAAG;AAC5B;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAEA,SAAK,MAAM,aAAa;AACxB,SAAK,KAAK,aAAa,EAAE,OAAO,IAAI,OAAO,QAAQ,IAAI,QAAQ,UAAU,CAAC;AAAA,EAC5E;AAAA,EAEA,UAAU,CAAC,MAAM;AACf,UAAM,MAAM,EAAE,UAAU,CAAC;AAGzB,eAAW,KAAK,KAAK,MAAM;AACzB,UAAI,eAAe,QAAQ,IAAI,OAAO,EAAE,OAAO,GAAG;AAChD,aAAK,SAAS,EAAE,IAAI,GAAG;AAAA,MACzB;AAAA,IACF;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,aAAa,CAAC,MAAM;AAClB,UAAM,KAAK,KAAK,IAAI,CAAC;AACrB,UAAM,QAAQ;AAAA,MACZ,GAAG,KAAK;AAAA,MACR,eAAe,KAAK,KAAK;AAAA,MACzB,SAAS,KAAK,QAAQ;AAAA,MACtB,UAAU,KAAK,SAAS;AAAA,MACxB,QAAQ,KAAK;AAAA,IACf;AAGA,OAAG;AAAA,MACD,IAAI,YAAY,eAAe;AAAA,QAC7B,QAAQ;AAAA,UACN,OAAO;AAAA,UACP,MAAM;AAAA,UACN,IAAI,OAAO,WAAW;AAAA,UACtB,IAAI,KAAK,IAAI;AAAA,QACf;AAAA,MACF,CAAC;AAAA,IACH;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,kBAAkB,CAAC,MAAM;AACvB,UAAM,EAAE,QAAQ,IAAI,EAAE,UAAU,CAAC;AAEjC,QAAI,SAAS;AAEX,UAAI,UAAU;AACd,iBAAW,SAAS,KAAK,SAAS,KAAK,GAAG;AACxC,YAAI,eAAe,QAAQ,OAAO,OAAO,GAAG;AAC1C,eAAK,SAAS,OAAO,KAAK;AAC1B,gBAAM,MAAM,KAAK,oBAAoB,QAAQ,KAAK;AAClD,cAAI,QAAQ,IAAI;AACd,iBAAK,oBAAoB,OAAO,KAAK,CAAC;AAAA,UACxC;AACA;AAAA,QACF;AAAA,MACF;AACA,WAAK,KAAK,WAAW,OAAO,wCAAwC,OAAO,EAAE;AAAA,IAC/E,OAAO;AAEL,YAAM,QAAQ,KAAK,SAAS;AAC5B,WAAK,SAAS,MAAM;AACpB,WAAK,sBAAsB,CAAC;AAC5B,WAAK,KAAK,eAAe,KAAK,oBAAoB;AAAA,IACpD;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,SAAS,QAAQ,KAAK;AACpB,QAAI;AACF,UAAI,CAAC,eAAe,MAAM,GAAG;AAC3B,eAAO;AAAA,MACT;AAEA,aAAO,cAAc,IAAI,YAAY,eAAe,EAAE,QAAQ,IAAI,CAAC,CAAC;AACpE,aAAO;AAAA,IACT,SAAS,KAAK;AACZ,WAAK,OAAO,mBAAmB,EAAE,OAAO,IAAI,OAAO,OAAO,IAAI,QAAQ,CAAC;AACvE,aAAO;AAAA,IACT;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,WAAW,QAAQ,MAAM,SAAS,UAAU,CAAC,GAAG;AAC9C,UAAM,WAAW;AAAA,MACf,OAAO;AAAA,MACP,MAAM,EAAE,MAAM,SAAS,QAAQ;AAAA,MAC/B,IAAI,OAAO,WAAW;AAAA,MACtB,IAAI,KAAK,IAAI;AAAA,IACf;AAEA,QAAI;AACF,aAAO,cAAc,IAAI,YAAY,eAAe,EAAE,QAAQ,SAAS,CAAC,CAAC;AAAA,IAC3E,SAAS,GAAG;AAEV,WAAK,OAAO,8BAA8B,EAAE,MAAM,QAAQ,CAAC;AAAA,IAC7D;AAGA,aAAS;AAAA,MACP,IAAI,YAAY,iBAAiB;AAAA,QAC/B,SAAS;AAAA,QACT,UAAU;AAAA,QACV,QAAQ,SAAS;AAAA,MACnB,CAAC;AAAA,IACH;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,IAAI,GAAG;AACL,WAAQ,OAAO,EAAE,iBAAiB,aAC9B,EAAE,aAAa,EAAE,CAAC,IACjB,EAAE,UAAU;AAAA,EACnB;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,QAAQ,MAAM;AACZ,QAAI,KAAK,OAAO,OAAO;AACrB,cAAQ,IAAI,aAAa,GAAG,IAAI;AAAA,IAClC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,UAAU,MAAM;AACd,YAAQ,MAAM,mBAAmB,GAAG,IAAI;AACxC,SAAK,MAAM;AAAA,EACb;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,OAAO,QAAQ,OAAO,SAAS;AAC7B,QAAI,YAAY,OAAO,UAAU,QAAS,QAAO;AAEjD,QAAI,WAAW,QAAQ,SAAS,GAAG,GAAG;AACpC,YAAM,MAAM,CAAC,MAAM,EAAE,QAAQ,uBAAuB,MAAM,EAAE,QAAQ,OAAO,OAAO;AAClF,YAAM,KAAK,IAAI,OAAO,IAAI,IAAI,OAAO,CAAC,GAAG;AACzC,aAAO,GAAG,KAAK,KAAK;AAAA,IACtB;AAEA,WAAO;AAAA,EACT;AACF;AAGA,eAAe,OAAO,oBAAoB,cAAc;AAExD,IAAO,kBAAQ;",
  "names": []
}
