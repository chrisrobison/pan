{
  "version": 3,
  "sources": ["../../pan/components/pan-chart.mjs"],
  "sourcesContent": ["// <pan-chart> \u2014 Chart wrapper with PAN integration\n// Attributes:\n//   - type: line, bar, pie, doughnut, radar, polarArea, scatter (default: line)\n//   - data: JSON chart data\n//   - options: JSON chart options\n//   - topic: Topic prefix for events\n//   - library: chart-js, custom (default: chart-js)\n//   - width: Chart width (default: 100%)\n//   - height: Chart height (default: 300px)\n//\n// Topics:\n//   - Publishes: {topic}.ready { chart }\n//   - Publishes: {topic}.click { dataPoint, datasetIndex, index }\n//   - Publishes: {topic}.hover { dataPoint, datasetIndex, index }\n//   - Subscribes: {topic}.update { data, options }\n//   - Subscribes: {topic}.addData { label, data }\n//   - Subscribes: {topic}.removeData { index }\n//\n// Notes:\n//   - Requires Chart.js to be loaded: <script src=\"https://cdn.jsdelivr.net/npm/chart.js\"></script>\n//   - For custom library, implement your own rendering via the 'custom-render' event\n\nimport { PanClient } from './pan-client.mjs';\n\nexport class PanChart extends HTMLElement {\n  static get observedAttributes() {\n    return ['type', 'data', 'options', 'topic', 'library', 'width', 'height'];\n  }\n\n  constructor() {\n    super();\n    this.attachShadow({ mode: 'open' });\n    this.pc = new PanClient(this);\n    this.chart = null;\n  }\n\n  connectedCallback() {\n    this.render();\n    this.setupTopics();\n    this.initChart();\n  }\n\n  disconnectedCallback() {\n    if (this.chart && this.chart.destroy) {\n      this.chart.destroy();\n    }\n  }\n\n  attributeChangedCallback(name, oldVal, newVal) {\n    if (!this.isConnected) return;\n\n    if (name === 'data' || name === 'options' || name === 'type') {\n      this.updateChart();\n    } else {\n      this.render();\n    }\n  }\n\n  get type() { return this.getAttribute('type') || 'line'; }\n  get data() {\n    const dataAttr = this.getAttribute('data');\n    if (!dataAttr) return this.getDefaultData();\n    try {\n      return JSON.parse(dataAttr);\n    } catch (e) {\n      console.error('Invalid data JSON:', e);\n      return this.getDefaultData();\n    }\n  }\n  get options() {\n    const optionsAttr = this.getAttribute('options');\n    if (!optionsAttr) return this.getDefaultOptions();\n    try {\n      return JSON.parse(optionsAttr);\n    } catch (e) {\n      console.error('Invalid options JSON:', e);\n      return this.getDefaultOptions();\n    }\n  }\n  get topic() { return this.getAttribute('topic') || 'chart'; }\n  get library() { return this.getAttribute('library') || 'chart-js'; }\n  get width() { return this.getAttribute('width') || '100%'; }\n  get height() { return this.getAttribute('height') || '300px'; }\n\n  getDefaultData() {\n    return {\n      labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],\n      datasets: [{\n        label: 'Sample Data',\n        data: [12, 19, 3, 5, 2, 3],\n        borderColor: '#6366f1',\n        backgroundColor: 'rgba(99, 102, 241, 0.1)',\n        tension: 0.4\n      }]\n    };\n  }\n\n  getDefaultOptions() {\n    return {\n      responsive: true,\n      maintainAspectRatio: false,\n      plugins: {\n        legend: {\n          display: true,\n          position: 'top'\n        }\n      },\n      onClick: (event, elements) => {\n        if (elements.length > 0) {\n          const element = elements[0];\n          const datasetIndex = element.datasetIndex;\n          const index = element.index;\n          const dataPoint = this.chart.data.datasets[datasetIndex].data[index];\n\n          this.pc.publish({\n            topic: `${this.topic}.click`,\n            data: { dataPoint, datasetIndex, index }\n          });\n        }\n      },\n      onHover: (event, elements) => {\n        if (elements.length > 0) {\n          const element = elements[0];\n          const datasetIndex = element.datasetIndex;\n          const index = element.index;\n          const dataPoint = this.chart.data.datasets[datasetIndex].data[index];\n\n          this.pc.publish({\n            topic: `${this.topic}.hover`,\n            data: { dataPoint, datasetIndex, index }\n          });\n        }\n      }\n    };\n  }\n\n  setupTopics() {\n    this.pc.subscribe(`${this.topic}.update`, (msg) => {\n      if (msg.data.data) {\n        this.setAttribute('data', JSON.stringify(msg.data.data));\n      }\n      if (msg.data.options) {\n        this.setAttribute('options', JSON.stringify(msg.data.options));\n      }\n    });\n\n    this.pc.subscribe(`${this.topic}.addData`, (msg) => {\n      if (this.chart && msg.data.label && msg.data.data) {\n        this.chart.data.labels.push(msg.data.label);\n        this.chart.data.datasets.forEach((dataset, i) => {\n          const value = Array.isArray(msg.data.data) ? msg.data.data[i] : msg.data.data;\n          dataset.data.push(value);\n        });\n        this.chart.update();\n      }\n    });\n\n    this.pc.subscribe(`${this.topic}.removeData`, (msg) => {\n      if (this.chart && typeof msg.data.index === 'number') {\n        this.chart.data.labels.splice(msg.data.index, 1);\n        this.chart.data.datasets.forEach((dataset) => {\n          dataset.data.splice(msg.data.index, 1);\n        });\n        this.chart.update();\n      }\n    });\n  }\n\n  async initChart() {\n    const canvas = this.shadowRoot.querySelector('canvas');\n    if (!canvas) return;\n\n    if (this.library === 'chart-js') {\n      // Check if Chart.js is loaded\n      if (typeof Chart === 'undefined') {\n        console.error('Chart.js is not loaded. Please include: <script src=\"https://cdn.jsdelivr.net/npm/chart.js\"></script>');\n        canvas.parentElement.innerHTML = `\n          <div style=\"padding: 2rem; text-align: center; color: #ef4444;\">\n            <strong>Chart.js not loaded</strong><br>\n            <small>Include Chart.js: &lt;script src=\"https://cdn.jsdelivr.net/npm/chart.js\"&gt;&lt;/script&gt;</small>\n          </div>\n        `;\n        return;\n      }\n\n      const ctx = canvas.getContext('2d');\n      const config = {\n        type: this.type,\n        data: this.data,\n        options: this.options\n      };\n\n      this.chart = new Chart(ctx, config);\n\n      this.pc.publish({\n        topic: `${this.topic}.ready`,\n        data: { chart: this.chart }\n      });\n    } else if (this.library === 'custom') {\n      // Dispatch custom render event for custom implementations\n      this.dispatchEvent(new CustomEvent('custom-render', {\n        detail: {\n          canvas,\n          data: this.data,\n          options: this.options,\n          type: this.type\n        }\n      }));\n    }\n  }\n\n  updateChart() {\n    if (!this.chart) {\n      this.initChart();\n      return;\n    }\n\n    if (this.library === 'chart-js') {\n      this.chart.data = this.data;\n      this.chart.options = this.options;\n      this.chart.update();\n    } else if (this.library === 'custom') {\n      this.dispatchEvent(new CustomEvent('custom-update', {\n        detail: {\n          data: this.data,\n          options: this.options\n        }\n      }));\n    }\n  }\n\n  render() {\n    this.shadowRoot.innerHTML = `\n      <style>\n        :host {\n          display: block;\n          width: ${this.width};\n          height: ${this.height};\n        }\n\n        .chart-container {\n          width: 100%;\n          height: 100%;\n          position: relative;\n          background: var(--chart-bg, #ffffff);\n          border-radius: var(--chart-radius, 0.5rem);\n          padding: var(--chart-padding, 1rem);\n          box-sizing: border-box;\n        }\n\n        .chart-wrapper {\n          width: 100%;\n          height: 100%;\n          position: relative;\n        }\n\n        canvas {\n          max-width: 100%;\n          max-height: 100%;\n        }\n\n        .loading {\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          height: 100%;\n          color: var(--chart-loading-color, #94a3b8);\n          font-size: 0.875rem;\n        }\n      </style>\n\n      <div class=\"chart-container\">\n        <div class=\"chart-wrapper\">\n          <canvas></canvas>\n        </div>\n      </div>\n    `;\n\n    // Re-init chart after render\n    if (this.isConnected) {\n      setTimeout(() => this.initChart(), 0);\n    }\n  }\n}\n\ncustomElements.define('pan-chart', PanChart);\nexport default PanChart;\n"],
  "mappings": "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",
  "names": []
}
