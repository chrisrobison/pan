{
  "version": 3,
  "sources": ["../../pan/components/pan-store.mjs"],
  "sourcesContent": ["// Reactive store (EventTarget + Proxy) and bind helper\n// Usage:\n//   import { createStore, bind } from './pan-store.js';\n//   const store = createStore({ name:'Ada' });\n//   const unbind = bind(el, store, { 'input[name=name]':'name' });\n\nexport function createStore(initial = {}) {\n  const bus = new EventTarget();\n  let updating = false; // guards against feedback loops\n  let state = structuredClone(initial);\n\n  const proxy = new Proxy(state, {\n    set(obj, key, value) {\n      if (Object.is(obj[key], value)) return true;\n      obj[key] = value;\n      if (!updating) bus.dispatchEvent(new CustomEvent('state', { detail: { key, value, state: proxy } }));\n      return true;\n    }\n  });\n\n  const setAll = (obj = {}) => {\n    updating = true;\n    try { for (const [k,v] of Object.entries(obj)) proxy[k] = v; }\n    finally { updating = false; }\n  };\n\n  return {\n    state: proxy,\n    subscribe(fn) { bus.addEventListener('state', fn); return () => bus.removeEventListener('state', fn); },\n    snapshot() { return JSON.parse(JSON.stringify(proxy)); },\n    set(k, v){ proxy[k] = v; },\n    patch(obj){ if (obj && typeof obj === 'object') setAll(obj); },\n    update(fn){ const cur = JSON.parse(JSON.stringify(proxy)); const next = fn(cur) || cur; setAll(next); },\n    _setAll: setAll,\n  };\n}\n\nexport function bind(el, store, map, opts={}){\n  const events = opts.events || ['input','change'];\n  const isCheck = (n) => n.type === 'checkbox';\n  const isRadio = (n) => n.type === 'radio';\n  const get = (n) => isCheck(n) ? !!n.checked : isRadio(n) ? n.value : n.value;\n  const set = (n, v) => {\n    if (isCheck(n)) n.checked = !!v;\n    else if (isRadio(n)) n.checked = n.value === String(v);\n    else n.value = v ?? '';\n  };\n\n  // UI -> Store\n  const unsubs = [];\n  for (const [selector, key] of Object.entries(map||{})){\n    el.querySelectorAll(selector).forEach(n=>{\n      const updateStore = () => { store.state[key] = get(n); };\n      for (const ev of events) n.addEventListener(ev, updateStore);\n      unsubs.push(()=>{ for (const ev of events) n.removeEventListener(ev, updateStore); });\n      set(n, store.state[key]);\n    });\n  }\n\n  // Store -> UI\n  const unsub = store.subscribe(({ detail:{ key, value } })=>{\n    for (const [selector, k] of Object.entries(map||{})){\n      if (k !== key) continue;\n      el.querySelectorAll(selector).forEach(n=> set(n, value));\n    }\n  });\n\n  return () => { try { unsub(); } catch {}; unsubs.forEach(f=>{ try{ f(); }catch{} }); };\n}\n\nexport default { createStore, bind };\n\n"],
  "mappings": "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",
  "names": []
}
