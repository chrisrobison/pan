{
  "version": 3,
  "sources": ["../../pan/components/pan-data-table.mjs"],
  "sourcesContent": ["// <pan-data-table> \u2014 Simple table that subscribes to `${resource}.list.state`\n// and publishes row selection via `${resource}.item.select`.\n\nimport { PanClient } from './pan-client.mjs';\n\nexport class PanDataTable extends HTMLElement {\n  static get observedAttributes(){ return ['resource','columns','key','live']; }\n  constructor(){ super(); this.attachShadow({mode:'open'}); this.pc = new PanClient(this); this.items = []; this._offs=[]; }\n  connectedCallback(){ this.render(); this.#subscribe(); this.#requestList(); }\n  disconnectedCallback(){ this._unsubscribeAll(); }\n  attributeChangedCallback(){ this.render(); this.#subscribe(); this.#requestList(); }\n\n  get resource(){ return (this.getAttribute('resource')||'items').trim(); }\n  get columns(){ const c=(this.getAttribute('columns')||'').trim(); return c? c.split(/\\s*,\\s*/): null; }\n  get key(){ return (this.getAttribute('key')||'id').trim(); }\n  get live(){ const v=(this.getAttribute('live')||'true').toLowerCase(); return v!== 'false' && v!== '0'; }\n\n  #subscribe(){\n    this._unsubscribeAll();\n    // Primary: listen to list state (retained) for bulk updates\n    this._offs.push(this.pc.subscribe(`${this.resource}.list.state`, (m)=>{ this.items = m?.data?.items || []; this.renderBody(); }, { retained:true }));\n    // Optional: granular live updates for individual items\n    if (this.live) {\n      this._offs.push(this.pc.subscribe(`${this.resource}.item.state.*`, (m)=> this.#onItemState(m), { retained:false }));\n    }\n  }\n\n  #requestList(){ this.pc.publish({ topic:`${this.resource}.list.get`, data:{} }); }\n\n  _unsubscribeAll(){ try { this._offs.forEach(f=>f&&f()); } catch {} this._offs=[]; }\n\n  #onItemState(m){\n    const d = m?.data || {}; const items = Array.isArray(this.items) ? this.items.slice() : []; const k = this.key;\n    // Derive id from payload or topic suffix\n    let id = d?.id ?? d?.item?.[k] ?? d?.item?.id;\n    if (id==null && m?.topic) { const parts = String(m.topic).split('.'); id = parts[parts.length-1]; }\n    if (id==null) return;\n    const idx = items.findIndex(x => String(x?.[k] ?? x?.id) === String(id));\n    if (d.deleted) {\n      if (idx >= 0) { items.splice(idx, 1); this.items = items; this.renderBody(); }\n      return;\n    }\n    if (d.item && typeof d.item === 'object') {\n      if (idx >= 0) items[idx] = d.item; else items.push(d.item);\n      this.items = items; this.renderBody(); return;\n    }\n    if (d.patch && typeof d.patch === 'object') {\n      const base = idx >= 0 ? items[idx] : {}; const next = Object.assign({}, base, d.patch);\n      if (idx >= 0) items[idx] = next; else items.push(next);\n      this.items = items; this.renderBody(); return;\n    }\n    // Fallback: treat d as patch\n    if (d && typeof d === 'object') {\n      const base = idx >= 0 ? items[idx] : {}; const next = Object.assign({}, base, d);\n      if (idx >= 0) items[idx] = next; else items.push(next);\n      this.items = items; this.renderBody();\n    }\n  }\n\n  render(){\n    const h = String.raw; const cols = this.columns || (this.items[0] ? Object.keys(this.items[0]) : []);\n    this.shadowRoot.innerHTML = h`\n      <style>\n        :host{display:block; border:1px solid #ddd; border-radius:8px; overflow:hidden; font:13px/1.4 system-ui, sans-serif}\n        table{width:100%; border-collapse:collapse}\n        th,td{padding:8px 10px; border-bottom:1px solid #eee; text-align:left}\n        tr:hover{ background:#fafafa; cursor:pointer }\n        thead th{ background:#f6f6f6; font-weight:600 }\n        .empty{ padding:10px; color:#888 }\n      </style>\n      <table>\n        <thead><tr>${cols.map(c=>`<th>${c}</th>`).join('')}</tr></thead>\n        <tbody></tbody>\n      </table>\n      <div class=\"empty\" id=\"empty\" hidden>No records.</div>\n    `;\n    this.renderBody();\n  }\n\n  renderBody(){\n    const tbody = this.shadowRoot.querySelector('tbody'); if (!tbody) return;\n    const cols = this.columns || (this.items[0] ? Object.keys(this.items[0]) : []);\n    tbody.innerHTML = this.items.map(it=>`<tr data-id=\"${it.id ?? it[this.getAttribute('key')||'id']}\">`+\n      cols.map(c=>`<td>${this.#escape(it[c])}</td>`).join('')+`</tr>`).join('');\n    const empty = this.shadowRoot.getElementById('empty');\n    if (empty) empty.hidden = this.items.length > 0;\n    tbody.querySelectorAll('tr').forEach(tr=>{\n      tr.addEventListener('click', ()=>{\n        const id = tr.getAttribute('data-id');\n        this.pc.publish({ topic:`${this.resource}.item.select`, data:{ id } });\n      });\n    });\n  }\n\n  #escape(v){ if (v==null) return ''; return String(v).replace(/[&<>\"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;','\\'':'&#39;'}[c])); }\n}\n\ncustomElements.define('pan-data-table', PanDataTable);\nexport default PanDataTable;\n"],
  "mappings": "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",
  "names": []
}
