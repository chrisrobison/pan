{
  "version": 3,
  "sources": ["../../pan/components/pan-data-provider-mock.mjs"],
  "sourcesContent": ["// <pan-data-provider> \u2014 Mock data provider for PAN CRUD demos\n// Handles generic topics for a named resource: `${resource}.list.get`, `${resource}.item.get`,\n// `${resource}.item.save`, `${resource}.item.delete`. Maintains `${resource}.list.state` (retain).\n\nimport { PanClient } from './pan-client.mjs';\n\nconst uuid = () => (globalThis.crypto && typeof crypto.randomUUID === 'function')\n  ? crypto.randomUUID()\n  : `${Date.now().toString(36)}-${Math.random().toString(36).slice(2, 10)}`;\n\nexport class PanDataProvider extends HTMLElement {\n  constructor(){\n    super();\n    this.pc = new PanClient(this);\n    this.items = [];\n  }\n\n  connectedCallback(){\n    this.resource = (this.getAttribute('resource') || 'items').trim();\n    this.key = (this.getAttribute('key') || 'id').trim();\n    this.persist = (this.getAttribute('persist') || '').toLowerCase() === 'localstorage';\n    this.storageKey = `pan:mock:${this.resource}`;\n    this.#load();\n    const listGet = `${this.resource}.list.get`;\n    const itemGet = `${this.resource}.item.get`;\n    const itemSave = `${this.resource}.item.save`;\n    const itemDelete = `${this.resource}.item.delete`;\n    this.off = [\n      this.pc.subscribe(listGet, (m)=> this.#onListGet(m)),\n      this.pc.subscribe(itemGet, (m)=> this.#onItemGet(m)),\n      this.pc.subscribe(itemSave, (m)=> this.#onItemSave(m)),\n      this.pc.subscribe(itemDelete, (m)=> this.#onItemDelete(m)),\n    ];\n    // Publish initial state\n    this.#publishListState();\n  }\n\n  disconnectedCallback(){ this.off?.forEach(f=>f&&f()); }\n\n  #load(){\n    // Seed from <script type=\"application/json\"> if present; else from localStorage; else []\n    const script = this.querySelector('script[type=\"application/json\"]');\n    if (script && script.textContent?.trim()) {\n      try { this.items = JSON.parse(script.textContent.trim()); this.#savePersist(); return; } catch {}\n    }\n    if (this.persist) {\n      try {\n        const raw = localStorage.getItem(this.storageKey);\n        if (raw) { this.items = JSON.parse(raw); return; }\n      } catch {}\n    }\n    this.items = [];\n  }\n\n  #savePersist(){\n    if (!this.persist) return;\n    try { localStorage.setItem(this.storageKey, JSON.stringify(this.items)); } catch {}\n  }\n\n  #publishListState(){\n    this.pc.publish({ topic: `${this.resource}.list.state`, data: { items: this.items }, retain: true });\n  }\n\n  #publishItemState(item, opts={}){\n    try {\n      const id = (item && typeof item==='object') ? (item[this.key] ?? item.id) : item;\n      if (id==null) return;\n      if (opts && opts.deleted) {\n        this.pc.publish({ topic: `${this.resource}.item.state.${id}`, data: { id, deleted: true } });\n      } else {\n        this.pc.publish({ topic: `${this.resource}.item.state.${id}`, data: { item }, retain: true });\n      }\n    } catch {}\n  }\n\n  #onListGet(m){\n    const { replyTo } = m;\n    if (replyTo) this.pc.publish({ topic: replyTo, correlationId: m.correlationId, data: { items: this.items } });\n    this.#publishListState();\n  }\n\n  #onItemGet(m){\n    const id = m?.data?.[this.key] ?? m?.data?.id ?? m?.data;\n    const item = this.items.find(x => String(x[this.key]) === String(id));\n    const res = item ? { ok: true, item } : { ok: false, error: 'NOT_FOUND', id };\n    if (item) this.#publishItemState(item);\n    if (m.replyTo) this.pc.publish({ topic: m.replyTo, correlationId: m.correlationId, data: res });\n  }\n\n  #onItemSave(m){\n    let item = m?.data?.item ?? m?.data;\n    if (!item || typeof item !== 'object') { item = {}; }\n    if (!item[this.key]) item[this.key] = uuid();\n    const id = item[this.key];\n    const idx = this.items.findIndex(x => String(x[this.key]) === String(id));\n    if (idx >= 0) this.items[idx] = Object.assign({}, this.items[idx], item);\n    else this.items.push(item);\n    this.#savePersist();\n    this.#publishListState();\n    this.#publishItemState(item);\n    if (m.replyTo) this.pc.publish({ topic: m.replyTo, correlationId: m.correlationId, data: { ok: true, item } });\n  }\n\n  #onItemDelete(m){\n    const id = m?.data?.[this.key] ?? m?.data?.id ?? m?.data;\n    const before = this.items.length;\n    this.items = this.items.filter(x => String(x[this.key]) !== String(id));\n    const ok = this.items.length !== before;\n    this.#savePersist();\n    this.#publishListState();\n    this.#publishItemState(id, { deleted:true });\n    if (m.replyTo) this.pc.publish({ topic: m.replyTo, correlationId: m.correlationId, data: { ok, id } });\n  }\n}\n\ncustomElements.define('pan-data-provider', PanDataProvider);\nexport default PanDataProvider;\n"],
  "mappings": "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",
  "names": []
}
