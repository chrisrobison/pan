{
  "version": 3,
  "sources": ["../../src/components/pan-forwarder.mjs"],
  "sourcesContent": ["// <pan-forwarder> \u2014 Mirror PAN topics to an HTTP endpoint (e.g., SSE hub POST)\n// Attributes:\n//   - dest: URL to POST to (required)\n//   - topics: space-separated patterns (default \"*\")\n//   - headers: JSON encoded headers, or semicolon-separated \"Key: Value; Key2: Value2\"\n//   - method: HTTP method (default POST)\n//   - with-credentials: include credentials (default true)\n//   - enabled: \"true\" to enable (default true)\n// Notes:\n//   - Body shape: { topic, data, retain?, id?, ts? }\n//   - Beware of loops if you also bridge the same server with <pan-sse>; prefer forwarding write intents only\n\nimport { PanClient } from './pan-client.mjs';\n\nexport class PanForwarder extends HTMLElement {\n  static get observedAttributes(){ return ['dest','topics','headers','method','with-credentials','enabled']; }\n  constructor(){ super(); this.pc = new PanClient(this); this._off=null; this._enabled=true; this._recent=new Set(); this._gcTimer=null; }\n  connectedCallback(){ this.#start(); }\n  disconnectedCallback(){ this.#stop(); }\n  attributeChangedCallback(){ this.#restart(); }\n\n  get dest(){ return (this.getAttribute('dest')||'').trim(); }\n  get topics(){ const t=(this.getAttribute('topics')||'*').trim(); return t? t.split(/\\s+/) : ['*']; }\n  get method(){ return (this.getAttribute('method')||'POST').toUpperCase(); }\n  get withCredentials(){ return (this.getAttribute('with-credentials')||'').toLowerCase() !== 'false'; }\n  get enabled(){ const v=(this.getAttribute('enabled')||'true').toLowerCase(); return v!== 'false' && v!== '0'; }\n  get headers(){\n    const raw = this.getAttribute('headers')||''; if (!raw) return {};\n    try { const j = JSON.parse(raw); if (j && typeof j==='object') return j; } catch {}\n    const out={}; raw.split(';').forEach(kv=>{ const m=kv.split(':'); if(m.length>=2){ const k=m.shift().trim(); const v=m.join(':').trim(); if(k) out[k]=v; }});\n    return out;\n  }\n\n  #restart(){ this.#stop(); this.#start(); }\n  #stop(){ try{ this._off && this._off(); }catch{} this._off=null; if (this._gcTimer) { clearInterval(this._gcTimer); this._gcTimer=null; } }\n\n  #start(){ if (!this.dest || !this.enabled) return; this._off = this.pc.subscribe(this.topics, (m)=> this.#send(m)); this._gcTimer=setInterval(()=>this.#gc(), 30000); }\n\n  async #send(m){\n    // Best-effort dedupe: skip if seen id recently\n    if (m?.id && this._recent.has(m.id)) return;\n    const body = { topic:m.topic, data:m.data, retain: !!m.retain, id:m.id, ts:m.ts };\n    const headers = Object.assign({ 'Content-Type':'application/json' }, this.headers);\n    try{\n      const res = await fetch(this.dest, { method:this.method, credentials: this.withCredentials? 'include':'omit', headers, body: JSON.stringify(body) });\n      if (!res.ok) { /* swallow */ }\n      if (m?.id) this._recent.add(m.id);\n    }catch{/* ignore network errors */}\n  }\n\n  #gc(){\n    // Cheap set reset periodically to avoid growth; ids are per page session anyway\n    this._recent = new Set();\n  }\n}\n\ncustomElements.define('pan-forwarder', PanForwarder);\nexport default PanForwarder;\n\n"],
  "mappings": "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",
  "names": []
}
