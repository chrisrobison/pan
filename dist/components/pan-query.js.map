{
  "version": 3,
  "sources": ["../../pan/components/pan-query.mjs"],
  "sourcesContent": ["// <pan-query> \u2014 Query orchestrator for PAN resources.\n// Maintains retained `${resource}.query.state` and triggers `${resource}.list.get`\n// when query params change. Accepts defaults via attribute or child JSON.\n// Optional URL sync (search or hash) for q/sort/page/size.\n\nimport { PanClient } from './pan-client.mjs';\n\nexport class PanQuery extends HTMLElement {\n  static get observedAttributes(){ return ['resource','defaults','sync-url','debounce-ms','auto-request']; }\n  constructor(){ super(); this.pc = new PanClient(this); this.state = {}; this.defaults = {}; this._timer = null; }\n\n  connectedCallback(){ this.#init(); }\n  disconnectedCallback(){ this.off?.forEach(f=>f&&f()); this.off = null; if (this._timer) { clearTimeout(this._timer); this._timer = null; } }\n  attributeChangedCallback(){ this.#init(); }\n\n  get resource(){ return (this.getAttribute('resource')||'items').trim(); }\n  get debounceMs(){ const n = Number(this.getAttribute('debounce-ms')); return Number.isFinite(n) && n>=0 ? n : 150; }\n  get autoRequest(){ const v=(this.getAttribute('auto-request')||'true').toLowerCase(); return v!== 'false' && v!== '0'; }\n  get syncUrl(){ const v=(this.getAttribute('sync-url')||'').toLowerCase(); return v==='search' || v==='hash' ? v : ''; }\n\n  #init(){\n    // Parse defaults\n    this.defaults = this.#readDefaults();\n    // Build initial state from defaults + URL\n    const urlParams = this.#readUrl();\n    this.state = Object.assign({}, this.defaults, urlParams);\n    // Publish retained state and (optionally) request list\n    this.#publishState();\n    if (this.autoRequest) this.#requestList();\n    // Rewire subscriptions\n    this.off?.forEach(f=>f&&f());\n    this.off = [\n      this.pc.subscribe(`${this.resource}.query.set`, (m)=> this.#merge(m?.data||{})),\n      this.pc.subscribe(`${this.resource}.query.reset`, ()=> this.#reset()),\n    ];\n  }\n\n  #readDefaults(){\n    // From attribute JSON or child <script type=\"application/json\">\n    let d = {};\n    const attr = this.getAttribute('defaults');\n    if (attr) { try { d = JSON.parse(attr); } catch {} }\n    const script = this.querySelector('script[type=\"application/json\"]');\n    if (script && script.textContent?.trim()) { try { d = Object.assign({}, d, JSON.parse(script.textContent.trim())); } catch {} }\n    return d;\n  }\n\n  #readUrl(){\n    if (!this.syncUrl) return {};\n    try {\n      const src = this.syncUrl === 'search' ? (new URL(location.href)).searchParams : new URLSearchParams((location.hash||'').replace(/^#\\??/,''));\n      const pick = (k)=> src.has(k) ? src.get(k) : undefined;\n      const out = {};\n      const q = pick('q'); if (q!=null) out.q = q;\n      const sort = pick('sort'); if (sort!=null) out.sort = sort;\n      const page = pick('page'); if (page!=null) out.page = Number(page)||1;\n      const size = pick('size'); if (size!=null) out.size = Number(size)||50;\n      return out;\n    } catch { return {}; }\n  }\n\n  #writeUrl(){\n    if (!this.syncUrl) return;\n    try {\n      const params = new URLSearchParams();\n      const { q, sort, page, size } = this.state;\n      if (q) params.set('q', String(q));\n      if (sort) params.set('sort', String(sort));\n      if (page!=null) params.set('page', String(page));\n      if (size!=null) params.set('size', String(size));\n      if (this.syncUrl === 'search') {\n        const url = new URL(location.href); url.search = params.toString(); history.replaceState(null, '', url.toString());\n      } else {\n        const s = params.toString(); location.hash = s ? ('#'+s) : '';\n      }\n    } catch {}\n  }\n\n  #publishState(){\n    this.pc.publish({ topic: `${this.resource}.query.state`, data: Object.assign({}, this.state), retain: true });\n  }\n\n  #requestList(){\n    const data = Object.assign({}, this.state);\n    this.pc.publish({ topic: `${this.resource}.list.get`, data });\n  }\n\n  #merge(patch){\n    this.state = Object.assign({}, this.state, patch||{});\n    this.#publishState();\n    this.#writeUrl();\n    if (this.autoRequest) this.#debounced();\n  }\n\n  #reset(){ this.state = Object.assign({}, this.defaults); this.#publishState(); this.#writeUrl(); if (this.autoRequest) this.#debounced(); }\n\n  #debounced(){\n    if (!this.debounceMs) return this.#requestList();\n    clearTimeout(this._timer); this._timer = setTimeout(()=> this.#requestList(), this.debounceMs);\n  }\n}\n\ncustomElements.define('pan-query', PanQuery);\nexport default PanQuery;\n\n"],
  "mappings": "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",
  "names": []
}
