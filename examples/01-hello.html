<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>PAN Demo Suite Â· 01 Hello Counter</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./assets/grail.css">
</head>
<body>
  <pan-bus></pan-bus>
  <div class="app-shell">
    

    <main class="main-region">
      <header class="main-header">
        <h1>Hello Counter</h1>
        <p>
          The smallest possible PAN demo: a single custom element publishes a retained counter topic and receives its own updates through the bus.
        </p>
        <div class="badge-row">
          <span class="badge">single topic</span>
          <span class="badge">retained delivery</span>
          <span class="badge">zero build</span>
        </div>
      </header>

      <section class="content-area">
        <section class="panel" style="max-width: 520px;">
          <div class="panel-header">
            <div>
              <h2>Counter Component</h2>
              <div class="subtitle">Publish <code>demo:click</code>, replay retained state on subscribe.</div>
            </div>
            <div class="toolbar">
              <a class="button-link" href="../dist/pan-client.js">PanClient API</a>
            </div>
          </div>
          <div class="panel-body">
            <x-counter></x-counter>
          </div>
        </section>
      </section>
    </main>
  </div>

  <script type="module">
    import { PanClient } from '../dist/pan-client.js';
    import '../dist/pan-bus.js';

    customElements.define('x-counter', class extends HTMLElement {
      pc = new PanClient(this);
      n = 0;
      connectedCallback() {
        this.innerHTML = `<button class="button-link" style="font-size:1.1rem;padding:0.75rem 1.2rem;">Clicked 0</button>`;
        this.querySelector('button')?.addEventListener('click', () => {
          this.pc.publish({ topic: 'demo:click', data: { n: ++this.n }, retain: true });
        });
        this.pc.subscribe('demo:click', (m) => {
          const btn = this.querySelector('button');
          if (btn) btn.textContent = `Clicked ${m.data.n}`;
        }, { retained: true });
      }
    });
  </script>
</body>
</html>
